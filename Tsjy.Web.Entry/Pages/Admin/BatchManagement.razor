@page "/Admin/BatchManagement"
@using Tsjy.Application.System.Dtos.BatchDtos
@using Tsjy.Core.Enums
@attribute [Authorize(Roles = "Admin")]
@inherits BootstrapComponentBase

<PageTitle>批次管理</PageTitle>

<div class="container-fluid p-3">
    <Table TItem="BatchListDto"
           IsPagination="true"
           IsStriped="true"
           IsBordered="true"
           ShowToolbar="true"
           ShowSearch="true"
           ShowDefaultButtons="true"
           ShowExtendButtons="true"
           OnQueryAsync="@OnQueryAsync"
           OnSaveAsync="@OnSaveAsync"
           OnDeleteAsync="@OnDeleteAsync">

        <TableColumns>
            @* ID 列 *@
            <TableColumn @bind-Field="@context.Id" Text="ID" Width="60" IsReadonly="true" />

            @* 名称列 (可搜索) *@
            <TableColumn @bind-Field="@context.Name" Text="批次名称" Searchable="true" />

            @* 状态列 (显示为标签) *@
            <TableColumn @bind-Field="@context.Status" Text="状态" Width="100" Align="Alignment.Center">
                <Template Context="value">
                    @if(value.Row.Status == PublicStatus.NotStarted)
                    {
                        <Tag Color="Color.Success">未开始</Tag>
                    }
                        else if(value.Row.Status == PublicStatus.InProgress)
                    {
                        <Tag Color="Color.Success">已发布</Tag>
                    }
						else
                    {
                        <Tag Color="Color.Secondary">已经结束</Tag>
                    }
                    
                </Template>
                <EditTemplate Context="value">
                    @* 编辑模板这里的 value 也是实体本身 *@
                    <Select @bind-Value="@value.Status" IsDisabled="true" />
                </EditTemplate>
            </TableColumn>

            @* 覆盖机构数列 (只读) *@
            <TableColumn @bind-Field="@context.OrgCount" Text="覆盖机构数" Width="120" IsReadonly="true" Align="Alignment.Center">
                <Template Context="value">
                    <span class="badge bg-info text-dark">@value.Value</span>
                </Template>
            </TableColumn>

            @* 生成时间列 (只读) *@
            <TableColumn @bind-Field="@context.CreatedAt" Text="生成时间" Width="180" FormatString="yyyy-MM-dd HH:mm" IsReadonly="true" />

            @* 启用状态开关 *@
            <TableColumn @bind-Field="@context.IsEnabled" Text="是否启用" Width="100" Align="Alignment.Center">
                <Template Context="value">
                    <Switch Value="@value.Row.IsEnabled"
                            OnValueChanged="@((bool v) => OnStatusChanged(value.Row, v))"
                            OnColor="Color.Success"
                            OffColor="Color.Secondary" />
                </Template>
                <EditTemplate Context="value">
                    <div class="col-12">
                        <span>请在列表页操作状态</span>
                    </div>
                </EditTemplate>
            </TableColumn>
        </TableColumns>
    </Table>
</div>